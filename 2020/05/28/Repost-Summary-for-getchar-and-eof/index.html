<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><title> Repost: Summary for getchar() and eof · xiaopc</title><meta name="description" content="Repost: Summary for getchar() and eof - xiaopc"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/blog-en/favicon.ico"><link rel="stylesheet" href="/blog-en/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://xiaopc.org/blog-en/atom.xml" title="xiaopc"><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/blog-en/atom.xml" title="xiaopc" type="application/atom+xml">
</head><body><div class="wrap"><header><a class="logo-link" href="/blog-en/"><img src="/blog-en/logo.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/blog-en/archives/" target="_self">archives</a></li><li class="nav-list-item"><a class="nav-list-link" href="/blog-en/links/" target="_self">links</a></li><li class="nav-list-item"><a class="nav-list-link" href="https://xpc.im/" target="_blank">about</a></li><li class="nav-list-item"><a class="nav-list-link" href="/blog-en/atom.xml" target="_self">rss</a></li><li class="nav-list-item"><a class="nav-list-link" href="https://xiaopc.org/" target="_blank">cn</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Repost: Summary for getchar() and eof</h1><div class="post-info">May 28, 2020 · <a href="/blog-en/categories/c-cpp/">c&cpp</a></div><div class="post-content"><p><em>original post date: July 22, 2016</em></p>
<span id="more"></span>
<p>Facing classic books, carefully read every word, and then understand. I was looking at <em>Section 1.5: Character Input and Output</em> of K&amp;R's <em>The C Programming Language Second Edition</em> , and was puzzled by <code>getchar()</code> and <code>EOF</code>. This may be due to a lack of understanding of how <code>getchar()</code> and <code>EOF</code> works. Therefore, it seems necessary to summarize, otherwise, a lot of trivial knowledge will fade away after a long time, only write down is the best way.</p>
<p>In fact, the most typical program is just a few lines of code. My Environment Is Debian GNU / Linux, as it is on other systems.</p>
<h2 id="two-points-for-getchar">Two Points for getchar()</h2>
<h3 id="getchar-is-processing-in-units-of-rows">getchar is processing in units of rows</h3>
<p>If the first character entered is a valid character, the input is the end-of-file Character EOF (Ctrl + Z for Windows; Ctrl + D for Unix / Linux). Then only if the last input character is a newline character <code>\n</code> or a end-of-file character, EOF will be discussed later, will getchar stop, and the whole program will run down. For example, the following sequence:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>((c = getchar()) != EOF)&#123;</span><br><span class="line">    <span class="built_in">putchar</span>(c);</span><br></pre></td></tr></table></figure>
<p>Execute the program, Type: <code>ABC</code>, then enter. Then the program executes <code>putchar(c)</code> and prints out <code>ABC</code>, which, don't forget, also has a carriage return. You can then proceed with the input, and when the newline character is encountered again, the program outputs the input character for that line to the terminal.</p>
<p>For <code>getchar()</code>, I'm sure many beginners will ask, isn't <code>getchar()</code> read by characters? So, now that I've entered the first character <code>a</code>, I must have a while loop <code>(c = getchar()) != EOF</code> condition, then <code>putchar(c)</code> should be executed to output a character <code>a</code> at the terminal. Yes, that's what I always thought when I used <code>getchar()</code>, but instead of doing that, the program had to read a newline or end-of-file EOF to get an output.</p>
<p>One explanation for this problem is that, when the creator wrote C, there was no such thing as terminal input. All input was actually read from a file, which was usually in behavioral units. Therefore, only when a newline character is encountered does the program think the input is finished and then take action to execute the rest of the program. Also, the input is accessed as a File, so ending a File input requires EOF. This is why <code>getchar()</code> ends the input exit with EOF.</p>
<h3 id="the-return-value-of-getchar-is-typically-a-character-but-it-can-also-be-negative-which-is-eof.">The return value of getchar() is typically a character, but it can also be negative, which is EOF.</h3>
<p>The point to emphasize here is that the <code>getchar()</code> function usually returns the characters entered by the terminal, which correspond to non-negative ASCII values in the character system. So, a lot of times, we would write code like this:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> c;</span><br><span class="line">c = getchar();</span><br></pre></td></tr></table></figure>
<p>There's a good chance something could go wrong. Because the <code>getchar()</code> function returns EOF when it encounters Ctrl+D on Linux, the EOF, in addition to the characters entered by the terminal, which is generally defined as <code>-1</code> in the library. Therefore, in this case, the <code>getchar()</code> function returns a negative value, and it is incorrect to assign a negative value to a variable of type <code>char</code>. In order to be able to define a variable that contains all the possible values returned by the <code>getchar()</code> function, the proper way to define it is as follows, specifically mentioned in K&amp;R:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> c;</span><br><span class="line">c = getchar();</span><br></pre></td></tr></table></figure>
<h2 id="two-points-for-eof">Two Points for EOF</h2>
<h3 id="eof-as-the-end-of-file-condition">EOF As the end-of-file condition</h3>
<p>EOF is the end-of-file character, but it is not always possible to end a file by typing Ctrl+D in Windows:</p>
<ol type="1">
<li><p>when the <code>getchar()</code> function is executed, to input the first character directly input Ctrl+D, You can jump out of <code>getchar()</code> to execute other parts of the program;</p></li>
<li><p>type Ctrl+D when the character you entered earlier is a newline character;</p></li>
<li><p>Enter Ctrl+D twice in a row if there is a character input before and it is not a newline character. The second input Ctrl+D functions as the end of the file. The first input Ctrl+D functions as shown below.</p></li>
</ol>
<p>In fact, all three cases can be summed up by saying that Ctrl+D is the end of the file only if getchar prompts for a new input.</p>
<h3 id="when-eof-is-the-line-terminator-typing-ctrld-does-not-end-getchar-but-only-causes-getchar-to-prompt-for-the-next-round-of-input">When EOF is the line Terminator, typing Ctrl+D does not end Getchar, but only causes getchar() to prompt for the next round of input</h3>
<p>This is mainly when a new line of <code>getchar()</code> input, when some characters can not contain a newline, directly press Ctrl+D, at this point the Ctrl+D is not the end of the file, but only the function equivalent to the newline, ends the current input. In the example above, if you type <code>abc</code> at run time and then Ctrl+D, The output is:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abcabc</span><br></pre></td></tr></table></figure>
<p>Note: The first set of <code>abc</code> is entered from the terminal, and then Ctrl+D is entered to output the second set of <code>abc</code>, with the cursor pausing after the C of the second set of characters, and then a new input can be made. At this point, if you type Ctrl+D again, it acts as the end of the file, ending <code>getchar()</code>.</p>
<p>If you type <code>abc</code>, then press Enter to enter a newline character, the terminal appears as:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">abc       // the first line with Enter \r</span><br><span class="line">abc       // the second line</span><br><span class="line">          // the third line</span><br></pre></td></tr></table></figure>
<p>Where the first line is the terminal input, the second line is the terminal output, and the cursor stops at the third line, waiting for a new terminal input.</p>
<p>You can also see the difference in the output when Ctrl+D and newline are used as line endings, respectively.</p>
<p>The function of EOF can also be summarized as follows: When the terminal has character input, Ctrl+D produces EOF equivalent to the end of the line input, will cause a new round of <code>getchar()</code> input; when the terminal has no character input or can say when <code>getchar()</code> reads a new round of input, type Ctrl+D and the resulting EOF corresponds to the end of the file, ending the execution of <code>getchar()</code>.</p>
<p>The summary of EOF in the second part of this article applies to the terminal driver in a one-line-at-a-time mode. That is, while <code>getchar()</code> and <code>putchar()</code> do follow one character at a time. But the terminal driver is in a one-line-at-a-time mode, where the input only ends at <code>\n</code> or Eof, so the output on the terminal is line-by-line.</p>
<p>If you want the terminal to read a character on the end of the input, the following procedure is one way to achieve reference to <em>C Expert Programming</em>, with a slight change:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> c;</span><br><span class="line">    <span class="comment">/* one-line-at-a-time */</span></span><br><span class="line">    system(<span class="string">&quot;stty codeblock&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* one-character-at-a-time */</span></span><br><span class="line">     c = getchar();</span><br><span class="line">    <span class="built_in">putchar</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* back to one-line-at-a-time */</span></span><br><span class="line">     system(<span class="string">&quot;stty cooked&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Compile to run the program, when such as enter a character, directly from a character, and then the end of the program.</p>
<p>Thus, due to the different terminal-driven mode, the conditions for the end of the Getchar input are different. A carriage return or EOF is required in normal mode, but in one character at a time mode, it ends after one character is entered.</p>
<hr />
<p>Origin(invalid link): http://blog.chinaunix.net/u1/53811/showart_421385.html</p>
<p>Repost: http://blog.csdn.net/ithomer/article/details/5669762</p>
</div><div class="post-footer"><p class="license"><b>This work is licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>. You are free to:</b><br>
Copy and redistribute the material;<br>
Remix, transform and build upon the material.<br>
<b>Under the following terms:</b><br>
Give appropriate credit and provide a link to this page;<br>
Distribute your contributions under the same license.</p></div></article></div></main><footer><div class="paginator"><a class="prev" href="/blog-en/2020/05/29/Introduction-for-Crypto-JS-and-a-common-issue/">prev</a><a class="next" href="/blog-en/2020/05/27/Speaking-of-httpoxy/">next</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'xiaopc-1';
var disqus_identifier = '2020/05/28/Repost-Summary-for-getchar-and-eof/';
var disqus_title = 'Repost: Summary for getchar() and eof';
var disqus_url = 'https://xiaopc.org/blog-en/2020/05/28/Repost-Summary-for-getchar-and-eof/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async></script><div class="copyright"><p>© 2023 <a href="https://xiaopc.org/blog-en">xiaopc</a>, <a href="https://hexo.io/" target="_blank">hexo</a> & <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdnjs.loli.net/ajax/libs/mathjax/2.7.2-rc/MathJax.js?config=TeX-AMS-MML_HTMLorMML" crossorigin="anonymous"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-KNHBVTCZSN"></script><script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', "G-KNHBVTCZSN");</script></body></html>